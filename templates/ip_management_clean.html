<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPAM - Advanced IP Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-used { color: #ef4444; background-color: #fef2f2; }
        .status-available { color: #10b981; background-color: #f0fdf4; }
        .status-reserved { color: #f59e0b; background-color: #fffbeb; }
        .sidebar { width: 280px; }
        .section { display: none; }
        .section.active { display: block; }
        .nav-item.active { background-color: rgba(255,255,255,0.2); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex">
    <!-- Sidebar -->
    <div class="sidebar gradient-bg text-white shadow-lg">
        <div class="p-6">
            <div class="flex items-center mb-8">
                <i class="fas fa-network-wired text-2xl mr-3"></i>
                <h1 class="text-xl font-bold">IPAM</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" onclick="showSection('dashboard', this)" class="nav-item active flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                </a>
                <a href="#" onclick="showSection('ip-management', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-list mr-3"></i>IP Management
                </a>
                <a href="/ip-auto-allocation" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-magic mr-3"></i>IP Auto Allocation
                    <span class="ml-auto bg-green-500 text-white text-xs px-2 py-1 rounded-full">NEW</span>
                </a>
                <a href="/csv-import" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-upload mr-3"></i>CSV Import
                    <span class="ml-auto bg-blue-500 text-white text-xs px-2 py-1 rounded-full">NEW</span>
                </a>
                <a href="#" onclick="showSection('subnet-management', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-sitemap mr-3"></i>Subnet Management
                </a>
                <a href="#" onclick="showSection('vrf-monitoring', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-project-diagram mr-3"></i>VRF Monitoring
                </a>
            </nav>
            
            <div class="mt-8">
                <h3 class="text-sm font-semibold text-white mb-4 opacity-80">QUICK ACTIONS</h3>
                <div class="space-y-2">
                    <button onclick="openAssignIPModal()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-plus mr-2"></i>Add IP
                    </button>
                    <button onclick="refreshData()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-sync mr-2"></i>Refresh Data
                    </button>
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-sm font-semibold text-white mb-4 opacity-80">TOOLS</h3>
                <div class="space-y-2">
                    <button onclick="openBulkAssignModal()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-download mr-2"></i>Import from CSV
                    </button>
                    <button onclick="clearFilters()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-times mr-2"></i>Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900" id="page-title">Dashboard Overview</h1>
                        <p class="text-gray-600 text-sm" id="page-subtitle">Real-time network statistics and monitoring</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="refreshData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active p-6">
            <!-- Top Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Available IPs Card -->
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white cursor-pointer transform hover:scale-105 transition-all duration-300" 
                     onclick="showIPDetailsModal('available')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">Available IPs</p>
                            <p class="text-3xl font-bold" id="available-ips">-</p>
                            <p class="text-green-100 text-xs mt-2" id="available-percentage">-% of total</p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-3">
                            <i class="fas fa-check-circle text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="fas fa-arrow-up mr-2"></i>
                        <span id="available-trend">Ready for allocation</span>
                    </div>
                </div>

                <!-- Used IPs Card -->
                <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white cursor-pointer transform hover:scale-105 transition-all duration-300"
                     onclick="showIPDetailsModal('used')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm font-medium">Used IPs</p>
                            <p class="text-3xl font-bold" id="used-ips">-</p>
                            <p class="text-red-100 text-xs mt-2" id="used-percentage">-% of total</p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-3">
                            <i class="fas fa-desktop text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="fas fa-chart-line mr-2"></i>
                        <span id="used-trend">Currently in use</span>
                    </div>
                </div>

                <!-- Reserved IPs Card -->
                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white cursor-pointer transform hover:scale-105 transition-all duration-300"
                     onclick="showIPDetailsModal('reserved')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm font-medium">Reserved IPs</p>
                            <p class="text-3xl font-bold" id="reserved-ips">-</p>
                            <p class="text-yellow-100 text-xs mt-2" id="reserved-percentage">-% of total</p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-3">
                            <i class="fas fa-bookmark text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="fas fa-clock mr-2"></i>
                        <span id="reserved-trend">Pending allocation</span>
                    </div>
                </div>

                <!-- Total Subnets Card -->
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white cursor-pointer transform hover:scale-105 transition-all duration-300"
                     onclick="showSubnetDetailsModal()">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium">Total Subnets</p>
                            <p class="text-3xl font-bold" id="total-subnets">-</p>
                            <p class="text-purple-100 text-xs mt-2" id="subnet-health">Health: Excellent</p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-3">
                            <i class="fas fa-network-wired text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="fas fa-shield-alt mr-2"></i>
                        <span id="subnet-trend">Networks managed</span>
                    </div>
                </div>
            </div>

            <!-- Network Overview Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- IP Utilization Chart -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-chart-pie mr-2 text-blue-600"></i>IP Utilization
                        </h3>
                        <button onclick="refreshUtilizationChart()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                    <div class="relative">
                        <canvas id="utilizationChart" width="400" height="200"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center" id="utilizationLoading">
                            <div class="text-center">
                                <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                                <p class="text-gray-500 mt-2">Loading chart...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VRF Distribution -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-sitemap mr-2 text-green-600"></i>Service Domains
                        </h3>
                        <button onclick="viewAllVRFs()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            View All →
                        </button>
                    </div>
                    <div id="vrfDistribution" class="space-y-3">
                        <div class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                            <p class="text-gray-500 mt-2">Loading VRF data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subnet Health Monitoring -->
            <div class="bg-white rounded-xl shadow-lg mb-6">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-heartbeat mr-2 text-red-600"></i>Subnet Health Monitoring
                        </h3>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <span class="text-sm text-gray-600">Healthy</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <span class="text-sm text-gray-600">Warning</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <span class="text-sm text-gray-600">Critical</span>
                            </div>
                            <button onclick="toggleSubnetDetails()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-chevron-down mr-1" id="subnet-toggle-icon"></i>Show Details
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="subnet-overview-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                            <p class="text-gray-500 mt-2">Loading subnet data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Recent IP Allocations -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-clock mr-2 text-orange-600"></i>Recent Activity
                        </h3>
                        <button onclick="viewAllActivity()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            View All →
                        </button>
                    </div>
                    <div id="recentActivity" class="space-y-4">
                        <div class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                            <p class="text-gray-500 mt-2">Loading activity...</p>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-server mr-2 text-indigo-600"></i>System Status
                        </h3>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm text-green-600 font-medium">Online</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- Database Status -->
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-database text-green-600 mr-3"></i>
                                <span class="font-medium text-gray-800">Database</span>
                            </div>
                            <span class="text-green-600 font-semibold">Connected</span>
                        </div>
                        
                        <!-- API Status -->
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-plug text-green-600 mr-3"></i>
                                <span class="font-medium text-gray-800">API Service</span>
                            </div>
                            <span class="text-green-600 font-semibold">Operational</span>
                        </div>
                        
                        <!-- Auto Allocation -->
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-magic text-blue-600 mr-3"></i>
                                <span class="font-medium text-gray-800">Auto Allocation</span>
                            </div>
                            <span class="text-blue-600 font-semibold">Ready</span>
                        </div>
                        
                        <!-- Last Update -->
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-clock text-gray-600 mr-3"></i>
                                <span class="font-medium text-gray-800">Last Update</span>
                            </div>
                            <span class="text-gray-600 font-semibold" id="lastUpdateTime">Just now</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IP Management Section -->
        <div id="ip-management-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">IP Address Management</h3>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600" id="total-ips-display">Loading...</span>
                            <button onclick="openAssignIPModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-plus mr-2"></i>Add IP
                            </button>
                        </div>
                    </div>
                    
                    <!-- IP Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subnet</label>
                            <input type="text" id="ip-subnet-filter" placeholder="e.g., 192.168.1.0/24" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="ip-status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">All Status</option>
                                <option value="used">Used</option>
                                <option value="available">Available</option>
                                <option value="reserved">Reserved</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Domain</label>
                            <input type="text" id="ip-vrf-filter" placeholder="VRF name" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div class="flex items-end">
                            <button onclick="applyIPFilters()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="ip-table-container">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading IP data...</p></div>
                    </div>
                    
                    <!-- Pagination -->
                    <div id="ip-pagination" class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-500" id="ip-pagination-info"></div>
                        <div class="flex space-x-2" id="ip-pagination-buttons"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subnet Management Section -->
        <div id="subnet-management-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Subnet Management</h3>
                            <p class="text-gray-600 text-sm">Analyze and manage IP subnets by CIDR ranges</p>
                        </div>
                        <button onclick="openAddSubnetModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i>Add Subnet
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <!-- Statistics Summary -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4" id="subnet-stats">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="total-subnets-count">-</div>
                            <div class="text-sm text-blue-600">Total Subnets</div>
                        </div>
                        <div class="bg-red-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-red-600" id="total-used-count">-</div>
                            <div class="text-sm text-red-600">Total Used IPs</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="total-free-count">-</div>
                            <div class="text-sm text-green-600">Total Free IPs</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600" id="avg-utilization">-</div>
                            <div class="text-sm text-purple-600">Avg Utilization</div>
                        </div>
                    </div>

                    <!-- CIDR Filter -->
                    <div class="mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filter by CIDR:</label>
                                <div class="flex space-x-2">
                                    <select id="cidr-input" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        <option value="16">/16 (65,536 addresses)</option>
                                        <option value="20">/20 (4,096 addresses)</option>
                                        <option value="22">/22 (1,024 addresses)</option>
                                        <option value="24" selected>/24 (256 addresses)</option>
                                        <option value="25">/25 (128 addresses)</option>
                                        <option value="26">/26 (64 addresses)</option>
                                        <option value="27">/27 (32 addresses)</option>
                                        <option value="28">/28 (16 addresses)</option>
                                        <option value="29">/29 (8 addresses)</option>
                                        <option value="30">/30 (4 addresses)</option>
                                    </select>
                                    <button onclick="applyCIDRFilter()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                        <i class="fas fa-filter mr-2"></i>Filter
                                    </button>
                                    <button onclick="clearCIDRFilter()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-sync mr-2"></i>Refresh
                                    </button>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500">
                                Quick filters: 
                                <button onclick="setQuickCIDR('24')" class="text-blue-600 hover:underline mx-1">/24</button>
                                <button onclick="setQuickCIDR('26')" class="text-blue-600 hover:underline mx-1">/26</button>
                                <button onclick="setQuickCIDR('30')" class="text-blue-600 hover:underline mx-1">/30</button>
                            </div>
                        </div>
                    </div>

                    <!-- Subnet Grid -->
                    <div id="subnet-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading...</p></div>
                    </div>
                    
                    <!-- Subnet List Table -->
                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">Configured Subnets</h4>
                            <button onclick="loadSubnetList()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Refresh List
                            </button>
                        </div>
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subnet</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Section</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VLAN</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VRF</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subnet-list-body" class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading subnet list...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- VRF Monitoring Section -->
        <div id="vrf-monitoring-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Service Domain Monitoring</h3>
                            <p class="text-gray-600 text-sm">Monitor IP address allocation across network service domains</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-500" id="vrf-last-update">Last updated: Loading...</span>
                            <button onclick="refreshVRFData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="vrf-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading VRF data...</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- IP Auto Allocation Section -->
    <div id="ip-auto-allocation-section" class="section p-6">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">IP Auto Allocation</h2>
                            <p class="text-gray-600 text-sm">Automatically suggest and reserve IP addresses for your services</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="refreshSubnetList()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Refresh Subnets
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- IP Allocation Form -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Form Section -->
                        <div class="space-y-6">
                            <h3 class="text-lg font-semibold text-gray-900">IP Allocation Request</h3>
                            
                            <!-- Subnet Selection -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Select Subnet</label>
                                <select id="allocation-subnet" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="updateSubnetInfo()">
                                    <option value="">Choose a subnet...</option>
                                </select>
                                <div id="subnet-info" class="mt-2 text-sm text-gray-600"></div>
                            </div>
                            
                            <!-- Number of IPs -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Number of IPs Required</label>
                                <input type="number" id="allocation-count" min="1" max="50" value="1" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <!-- VRF/VPN -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">VRF/Service Domain</label>
                                <select id="allocation-vrf" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select VRF...</option>
                                </select>
                            </div>
                            
                            <!-- Service Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Service Name</label>
                                <input type="text" id="allocation-service" placeholder="e.g., web-server, database, etc." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <!-- Description -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="allocation-description" rows="3" placeholder="Describe the purpose of these IPs..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex space-x-3">
                                <button onclick="getSuggestedIPs()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    <i class="fas fa-search mr-2"></i>Get IP Suggestions
                                </button>
                                <button onclick="clearForm()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                                    <i class="fas fa-eraser mr-2"></i>Clear
                                </button>
                            </div>
                        </div>
                        
                        <!-- Suggestions Section -->
                        <div class="space-y-6">
                            <h3 class="text-lg font-semibold text-gray-900">Suggested IP Addresses</h3>
                            
                            <div id="suggestions-container" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                                <i class="fas fa-lightbulb text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-500">Click "Get IP Suggestions" to see available IPs</p>
                            </div>
                            
                            <!-- Reserve Button -->
                            <div id="reserve-section" class="hidden">
                                <button onclick="reserveAllIPs()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg">
                                    <i class="fas fa-bookmark mr-2"></i>Reserve All IPs
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subnet Detail Modal -->
    <div id="subnet-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900" id="modal-subnet-title">Subnet Details</h3>
                        <p class="text-gray-600 text-sm" id="modal-subnet-info">Network information and IP allocation</p>
                    </div>
                    <button onclick="closeSubnetModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- Subnet Summary -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="text-sm text-blue-600 font-medium">Total IPs</div>
                        <div class="text-2xl font-bold text-blue-900" id="modal-total-ips">-</div>
                        <div class="text-xs text-blue-600" id="modal-network-info">-</div>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4">
                        <div class="text-sm text-red-600 font-medium">Used IPs</div>
                        <div class="text-2xl font-bold text-red-900" id="modal-used-ips">-</div>
                        <div class="text-xs text-red-600" id="modal-used-percent">-</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="text-sm text-green-600 font-medium">Available IPs</div>
                        <div class="text-2xl font-bold text-green-900" id="modal-available-ips">-</div>
                        <div class="text-xs text-green-600" id="modal-available-percent">-</div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <div class="text-sm text-yellow-600 font-medium">Reserved IPs</div>
                        <div class="text-2xl font-bold text-yellow-900" id="modal-reserved-ips">-</div>
                        <div class="text-xs text-yellow-600" id="modal-reserved-percent">-</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-purple-600 font-medium">Utilization</div>
                        <div class="text-2xl font-bold text-purple-900" id="modal-utilization">-</div>
                        <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                            <div class="bg-purple-600 h-2 rounded-full" id="modal-utilization-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- VRF Summary -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-3">Service Domain Summary</h4>
                    <div id="modal-vrf-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- VRF summary will be populated here -->
                    </div>
                </div>

                <!-- IP Filter -->
                <div class="mb-4 flex items-center space-x-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Status:</label>
                        <select id="modal-ip-filter" onchange="filterModalIPs()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">All IPs</option>
                            <option value="used">Used Only</option>
                            <option value="available">Available Only</option>
                            <option value="reserved">Reserved Only</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Filter by VRF:</label>
                        <select id="modal-vrf-filter" onchange="filterModalIPs()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">All VRFs</option>
                        </select>
                    </div>
                </div>

                <!-- IP List -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Address</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hostname/Device</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Device Info</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Interface</th>
                            </tr>
                        </thead>
                        <tbody id="modal-ip-list" class="bg-white divide-y divide-gray-200">
                            <!-- IP list will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 space-y-3"></div>    <script>
        // Global state
        let currentSection = 'dashboard';
        let currentPage = 1;
        let currentFilters = {};
        let ipData = [];
        let currentSubnetData = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
        });

        // Navigation functions
        function showSection(sectionName, triggerElement) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // Add active class to clicked nav item
            if (triggerElement) {
                triggerElement.closest('.nav-item').classList.add('active');
            } else {
                // Find nav item by onclick attribute for programmatic calls
                const navLink = document.querySelector(`[onclick*="showSection('${sectionName}',"]`);
                if (navLink) {
                    navLink.closest('.nav-item').classList.add('active');
                }
            }
            
            currentSection = sectionName;
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard Overview',
                'ip-management': 'IP Address Management', 
                'subnet-management': 'Subnet Management',
                'vrf-monitoring': 'Service Domain Monitoring',
                'auto-allocation': 'Automated IP Allocation'
            };
            
            const subtitles = {
                'dashboard': 'Real-time network statistics and monitoring',
                'ip-management': 'Complete IP address inventory and assignment',
                'subnet-management': 'Subnet analysis and CIDR management',
                'vrf-monitoring': 'Monitor IP allocation across Service Domains',
                'auto-allocation': 'Intelligent IP address allocation and reservation'
            };
            
            document.getElementById('page-title').textContent = titles[sectionName] || 'IPAM System';
            document.getElementById('page-subtitle').textContent = subtitles[sectionName] || 'IP Address Management System';
            
            // Load section-specific data
            if (sectionName === 'dashboard') {
                loadDashboardData();
            } else if (sectionName === 'ip-management') {
                loadIPManagement();
            } else if (sectionName === 'subnet-management') {
                loadSubnetManagement();
                loadSubnetList();
            } else if (sectionName === 'vrf-monitoring') {
                loadVRFMonitoring();
            } else if (sectionName === 'auto-allocation') {
                loadAutoAllocationData();
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                const totalIPs = data.total_possible_ips || data.total_ips || (data.available_ips + data.used_ips + data.reserved_ips);
                
                // Update main stats
                document.getElementById('available-ips').textContent = data.available_ips?.toLocaleString() || '0';
                document.getElementById('used-ips').textContent = data.used_ips?.toLocaleString() || '0';
                document.getElementById('reserved-ips').textContent = data.reserved_ips?.toLocaleString() || '0';
                document.getElementById('total-subnets').textContent = data.total_subnets?.toLocaleString() || '0';
                
                // Update percentages
                if (totalIPs > 0) {
                    document.getElementById('available-percentage').textContent = `${((data.available_ips / totalIPs) * 100).toFixed(1)}% of total`;
                    document.getElementById('used-percentage').textContent = `${((data.used_ips / totalIPs) * 100).toFixed(1)}% of total`;
                    document.getElementById('reserved-percentage').textContent = `${((data.reserved_ips / totalIPs) * 100).toFixed(1)}% of total`;
                }
                
                // Update health status
                const utilizationPercent = data.utilization_percentage || 0;
                let healthStatus = 'Excellent';
                if (utilizationPercent > 85) healthStatus = 'Critical';
                else if (utilizationPercent > 70) healthStatus = 'Warning';
                else if (utilizationPercent > 50) healthStatus = 'Good';
                
                document.getElementById('subnet-health').textContent = `Health: ${healthStatus}`;
                
                // Update last update time
                document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString();
                
                // Load additional dashboard components
                await Promise.all([
                    loadVRFDistribution(),
                    loadRecentActivity(),
                    loadUtilizationChart()
                ]);
                
                loadSubnetOverview();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Failed to load dashboard data', 'error');
            }
        }

        async function loadVRFDistribution() {
            try {
                const response = await fetch('/api/vrf-monitoring');
                const data = await response.json();
                
                const container = document.getElementById('vrfDistribution');
                
                if (data.vrf_data && data.vrf_data.length > 0) {
                    const topVRFs = data.vrf_data.slice(0, 5); // Top 5 VRFs
                    
                    container.innerHTML = topVRFs.map(vrf => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"
                             onclick="showVRFDetail('${vrf.vrf_name}')">
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-full mr-3" style="background-color: ${getVRFColor(vrf.vrf_name)}"></div>
                                <div>
                                    <div class="font-medium text-gray-800">${vrf.vrf_name}</div>
                                    <div class="text-sm text-gray-500">${vrf.total_ips} IPs total</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-gray-800">${vrf.utilization_percentage}%</div>
                                <div class="text-xs text-gray-500">utilization</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-network-wired text-4xl mb-3"></i>
                            <p>No VRF data available</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading VRF distribution:', error);
            }
        }

        async function loadRecentActivity() {
            try {
                const response = await fetch('/api/ip-data?limit=10');
                const data = await response.json();
                
                const container = document.getElementById('recentActivity');
                
                if (data.data && data.data.length > 0) {
                    // Sort by updated_at to get recent activity
                    const recentItems = data.data
                        .filter(item => item.updated_at)
                        .sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at))
                        .slice(0, 5);
                    
                    container.innerHTML = recentItems.map(item => {
                        const date = new Date(item.updated_at);
                        const timeAgo = getTimeAgo(date);
                        const statusColor = getStatusColor(item.status);
                        
                        return `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                <div class="w-2 h-2 rounded-full ${statusColor}"></div>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">${item.ip_address}</div>
                                    <div class="text-sm text-gray-500">${item.hostname || 'No hostname'} • ${item.status}</div>
                                </div>
                                <div class="text-xs text-gray-400">${timeAgo}</div>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-clock text-4xl mb-3"></i>
                            <p>No recent activity</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        async function loadUtilizationChart() {
            try {
                // Hide loading and show a simple text-based chart for now
                const loadingElement = document.getElementById('utilizationLoading');
                if (loadingElement) loadingElement.style.display = 'none';
                
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                const canvas = document.getElementById('utilizationChart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                
                // Simple pie chart representation
                const total = data.available_ips + data.used_ips + data.reserved_ips;
                if (total > 0) {
                    const availablePercent = (data.available_ips / total) * 100;
                    const usedPercent = (data.used_ips / total) * 100;
                    const reservedPercent = (data.reserved_ips / total) * 100;
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw simple bars
                    const barHeight = 40;
                    const barY = (canvas.height - barHeight) / 2;
                    
                    // Available (green)
                    ctx.fillStyle = '#10B981';
                    ctx.fillRect(0, barY, (availablePercent / 100) * canvas.width, barHeight);
                    
                    // Used (red)
                    const usedStart = (availablePercent / 100) * canvas.width;
                    ctx.fillStyle = '#EF4444';
                    ctx.fillRect(usedStart, barY, (usedPercent / 100) * canvas.width, barHeight);
                    
                    // Reserved (yellow)
                    const reservedStart = usedStart + (usedPercent / 100) * canvas.width;
                    ctx.fillStyle = '#F59E0B';
                    ctx.fillRect(reservedStart, barY, (reservedPercent / 100) * canvas.width, barHeight);
                    
                    // Add labels
                    ctx.fillStyle = '#374151';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`Available: ${availablePercent.toFixed(1)}%`, canvas.width * 0.2, barY - 10);
                    ctx.fillText(`Used: ${usedPercent.toFixed(1)}%`, canvas.width * 0.5, barY - 10);
                    ctx.fillText(`Reserved: ${reservedPercent.toFixed(1)}%`, canvas.width * 0.8, barY - 10);
                }
            } catch (error) {
                console.error('Error loading utilization chart:', error);
            }
        }

        // Modal functions
        async function showIPDetailsModal(status) {
            try {
                const modal = document.getElementById('ipDetailsModal');
                const title = document.getElementById('ipModalTitle');
                const content = document.getElementById('ipModalContent');
                
                title.textContent = `${status.charAt(0).toUpperCase() + status.slice(1)} IP Addresses`;
                content.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="text-gray-500 mt-2">Loading IP details...</p>
                    </div>
                `;
                
                modal.classList.remove('hidden');
                
                const response = await fetch(`/api/ip-data?status=${status}&limit=100`);
                const data = await response.json();
                
                if (data.data && data.data.length > 0) {
                    content.innerHTML = `
                        <div class="mb-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">Total: ${data.data.length} IPs</h3>
                                <button onclick="exportIPData('${status}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-download mr-2"></i>Export
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">IP Address</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Subnet</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Hostname</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">VRF</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.data.map(ip => `
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="px-4 py-2 font-mono">${ip.ip_address}</td>
                                            <td class="px-4 py-2 font-mono">${ip.subnet || '-'}</td>
                                            <td class="px-4 py-2">${ip.hostname || '-'}</td>
                                            <td class="px-4 py-2">${ip.vrf_vpn || '-'}</td>
                                            <td class="px-4 py-2 text-sm text-gray-600">${ip.description || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    content.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-search text-4xl mb-3"></i>
                            <p>No ${status} IPs found</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading IP details:', error);
                document.getElementById('ipModalContent').innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                        <p>Failed to load IP details</p>
                    </div>
                `;
            }
        }

        async function showSubnetDetailsModal() {
            try {
                const modal = document.getElementById('subnetDetailsModal');
                const content = document.getElementById('subnetModalContent');
                
                content.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="text-gray-500 mt-2">Loading subnet details...</p>
                    </div>
                `;
                
                modal.classList.remove('hidden');
                
                const response = await fetch('/api/subnets-overview');
                const data = await response.json();
                
                if (data.subnets && data.subnets.length > 0) {
                    content.innerHTML = `
                        <div class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-green-50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-green-600">${data.subnets.filter(s => s.utilization < 50).length}</div>
                                    <div class="text-sm text-green-700">Healthy Subnets</div>
                                </div>
                                <div class="bg-yellow-50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-yellow-600">${data.subnets.filter(s => s.utilization >= 50 && s.utilization < 80).length}</div>
                                    <div class="text-sm text-yellow-700">Warning Subnets</div>
                                </div>
                                <div class="bg-red-50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-red-600">${data.subnets.filter(s => s.utilization >= 80).length}</div>
                                    <div class="text-sm text-red-700">Critical Subnets</div>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-blue-600">${data.subnets.reduce((sum, s) => sum + s.available_ips, 0).toLocaleString()}</div>
                                    <div class="text-sm text-blue-700">Total Available IPs</div>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Subnet</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Total IPs</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Used</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Available</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Utilization</th>
                                        <th class="px-4 py-2 text-left font-medium text-gray-700">Health</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.subnets.map(subnet => {
                                        const healthClass = subnet.utilization < 50 ? 'text-green-600' : subnet.utilization < 80 ? 'text-yellow-600' : 'text-red-600';
                                        const healthIcon = subnet.utilization < 50 ? 'fa-check-circle' : subnet.utilization < 80 ? 'fa-exclamation-triangle' : 'fa-times-circle';
                                        
                                        return `
                                            <tr class="border-b hover:bg-gray-50">
                                                <td class="px-4 py-2 font-mono">${subnet.subnet}</td>
                                                <td class="px-4 py-2">${subnet.total_ips}</td>
                                                <td class="px-4 py-2">${subnet.used_ips}</td>
                                                <td class="px-4 py-2">${subnet.available_ips}</td>
                                                <td class="px-4 py-2">
                                                    <div class="flex items-center">
                                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${subnet.utilization}%"></div>
                                                        </div>
                                                        <span class="text-sm">${subnet.utilization}%</span>
                                                    </div>
                                                </td>
                                                <td class="px-4 py-2">
                                                    <i class="fas ${healthIcon} ${healthClass}"></i>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    content.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-network-wired text-4xl mb-3"></i>
                            <p>No subnet data available</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading subnet details:', error);
            }
        }

        function closeIPDetailsModal() {
            document.getElementById('ipDetailsModal').classList.add('hidden');
        }

        function closeSubnetDetailsModal() {
            document.getElementById('subnetDetailsModal').classList.add('hidden');
        }

        function closeVRFDetailsModal() {
            document.getElementById('vrfDetailsModal').classList.add('hidden');
        }

        // Utility functions
        function getVRFColor(vrfName) {
            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4'];
            const hash = vrfName.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
            return colors[hash % colors.length];
        }

        function getStatusColor(status) {
            switch (status) {
                case 'used': return 'bg-red-500';
                case 'available': return 'bg-green-500';
                case 'reserved': return 'bg-yellow-500';
                default: return 'bg-gray-500';
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'Just now';
        }

        function refreshUtilizationChart() {
            loadUtilizationChart();
        }

        function viewAllVRFs() {
            showSection('vrf-monitoring');
        }

        function viewAllActivity() {
            showSection('ip-management');
        }

        function exportIPData(status) {
            window.open(`/api/ip-data?status=${status}&limit=1000&format=csv`, '_blank');
        }

        // Load IP management section
        async function loadIPManagement() {
            try {
                loadIPList(1); // Load first page
            } catch (error) {
                console.error('Error loading IP management:', error);
                showToast('Failed to load IP management data', 'error');
            }
        }

        // Load IP list with pagination and filters
        async function loadIPList(page = 1) {
            try {
                const subnetFilter = document.getElementById('ip-subnet-filter')?.value || '';
                const statusFilter = document.getElementById('ip-status-filter')?.value || '';
                const vrfFilter = document.getElementById('ip-vrf-filter')?.value || '';
                
                const params = new URLSearchParams({
                    page: page,
                    per_page: 50,
                    subnet: subnetFilter,
                    status: statusFilter,
                    vrf: vrfFilter
                });
                
                const response = await fetch(`/api/ip-list?${params}`);
                const data = await response.json();
                
                // Update total count
                document.getElementById('total-ips-display').textContent = `${data.pagination.total.toLocaleString()} Total IPs`;
                
                // Render IP table
                renderIPTable(data.ips);
                
                // Render pagination
                renderIPPagination(data.pagination, page);
                
            } catch (error) {
                console.error('Error loading IP list:', error);
                document.getElementById('ip-table-container').innerHTML = '<div class="text-center py-8 text-red-500">Failed to load IP data</div>';
            }
        }

        // Render IP table
        function renderIPTable(ips) {
            const container = document.getElementById('ip-table-container');
            
            if (!ips || ips.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No IP addresses found</div>';
                return;
            }
            
            const tableHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP Address</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subnet</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hostname</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service Domain</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Updated</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${ips.map(ip => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="font-mono text-sm font-medium text-gray-900">${ip.ip_address}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-gray-500">${ip.subnet || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                            ${ip.status === 'used' ? 'bg-red-100 text-red-800' : 
                                              ip.status === 'available' ? 'bg-green-100 text-green-800' : 
                                              'bg-yellow-100 text-yellow-800'}">
                                            ${ip.status}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-gray-900">${ip.hostname || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-purple-600">${ip.vrf_vpn || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${ip.updated_at || '-'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // Render pagination
        function renderIPPagination(pagination, currentPage) {
            const info = document.getElementById('ip-pagination-info');
            const buttons = document.getElementById('ip-pagination-buttons');
            
            // Update info
            const start = (currentPage - 1) * pagination.per_page + 1;
            const end = Math.min(currentPage * pagination.per_page, pagination.total);
            info.textContent = `Showing ${start}-${end} of ${pagination.total.toLocaleString()} results`;
            
            // Generate pagination buttons
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `<button onclick="loadIPList(${currentPage - 1})" class="px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">Previous</button>`;
            }
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(pagination.pages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? 'bg-purple-600 text-white' : 'border hover:bg-gray-50';
                paginationHTML += `<button onclick="loadIPList(${i})" class="px-3 py-2 text-sm rounded-lg ${active}">${i}</button>`;
            }
            
            // Next button
            if (currentPage < pagination.pages) {
                paginationHTML += `<button onclick="loadIPList(${currentPage + 1})" class="px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">Next</button>`;
            }
            
            buttons.innerHTML = paginationHTML;
        }

        // Load subnet management data
        async function loadSubnetManagement() {
            try {
                const cidrInput = document.getElementById('cidr-input')?.value || '24';
                // Extract number from CIDR input (e.g., "/24" or "24" -> "24")
                const cidrNumber = cidrInput.replace('/', '');
                const response = await fetch(`/api/subnet-monitor?cidr=${cidrNumber}`);
                const data = await response.json();
                
                const container = document.getElementById('subnet-grid');
                
                if (!data.subnets || data.subnets.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No subnet data available</div>';
                    return;
                }

                // Update statistics
                const totalUsed = data.subnets.reduce((sum, subnet) => sum + subnet.used, 0);
                const totalFree = data.subnets.reduce((sum, subnet) => sum + subnet.free, 0);
                const totalAddresses = totalUsed + totalFree;
                const avgUtilization = totalAddresses > 0 ? (totalUsed / totalAddresses * 100) : 0;

                document.getElementById('total-subnets-count').textContent = data.total_subnets || data.subnets.length;
                document.getElementById('total-used-count').textContent = totalUsed.toLocaleString();
                document.getElementById('total-free-count').textContent = totalFree.toLocaleString();
                document.getElementById('avg-utilization').textContent = avgUtilization.toFixed(1) + '%';
                
                container.innerHTML = data.subnets.map(subnet => `
                    <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition cursor-pointer border-l-4 border-${getStatusColorClass(subnet.status_color)}-500" onclick="openSubnetDetail('${subnet.subnet}')">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="font-mono text-lg font-semibold text-gray-900">${subnet.subnet}</h4>
                            <span class="text-sm px-3 py-1 bg-blue-100 text-blue-800 rounded-full">
                                private
                            </span>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total IPs:</span>
                                <span class="font-semibold">${subnet.total_addresses.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span class="font-semibold text-red-600">${subnet.used}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span class="font-semibold text-green-600">${subnet.free}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Reserved:</span>
                                <span class="font-semibold text-yellow-600">0</span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${getStatusColorClass(subnet.status_color)}-600 h-2 rounded-full" style="width: ${subnet.usage_percentage}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Utilization</span>
                                <span>${subnet.usage_percentage}%</span>
                            </div>
                        </div>
                        
                        ${subnet.vrfs ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <div class="text-xs text-gray-500 mb-1">Service Domain:</div>
                                <div class="text-xs text-purple-600 truncate">${subnet.vrfs}</div>
                            </div>
                        ` : ''}
                        
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-2">
                                <span class="font-medium">Service Domain:</span> 
                                <span class="text-blue-600">${subnet.vrf_vpns ? subnet.vrf_vpns.join(', ') : 'default'}</span>
                            </div>
                            <div class="text-xs text-blue-600 font-medium">
                                <i class="fas fa-info-circle mr-1"></i>Click to view detailed IP list
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading subnet management:', error);
                showToast('Failed to load subnet data', 'error');
            }
        }

        // Helper function to get status color class
        function getStatusColorClass(color) {
            switch(color) {
                case 'green': return 'green';
                case 'yellow': return 'yellow';
                case 'red': return 'red';
                default: return 'blue';
            }
        }

        // CIDR Filter functions
        function applyCIDRFilter() {
            loadSubnetManagement();
            showToast('CIDR filter applied', 'success');
        }

        function clearCIDRFilter() {
            document.getElementById('cidr-input').value = '24';
            loadSubnetManagement();
            showToast('Refreshed with /24 filter', 'success');
        }

        function setQuickCIDR(cidr) {
            document.getElementById('cidr-input').value = cidr;
            loadSubnetManagement();
            showToast(`Filtered by /${cidr}`, 'success');
        }

        // Add event listener for dropdown change
        document.addEventListener('DOMContentLoaded', function() {
            const cidrSelect = document.getElementById('cidr-input');
            if (cidrSelect) {
                cidrSelect.addEventListener('change', function() {
                    loadSubnetManagement();
                    showToast(`Switched to /${this.value} view`, 'success');
                });
            }
        });

        // IP Filter functions
        function applyIPFilters() {
            loadIPList(1); // Reset to first page when filtering
            showToast('IP filters applied', 'success');
        }

        // Load subnet overview
        async function loadSubnetOverview() {
            try {
                const response = await fetch('/api/subnets-overview');
                const data = await response.json();
                
                const container = document.getElementById('subnet-overview-grid');
                
                if (!data.subnets || data.subnets.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No subnet data available</div>';
                    return;
                }
                
                // Show first 8 subnets in overview
                const overviewSubnets = data.subnets.slice(0, 8);
                
                container.innerHTML = overviewSubnets.map(subnet => `
                    <div class="bg-gray-50 rounded-lg p-4 border">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-mono text-sm font-semibold text-gray-900">${subnet.subnet}</h4>
                            <span class="text-xs px-2 py-1 bg-${subnet.ip_type === 'private' ? 'blue' : 'green'}-100 text-${subnet.ip_type === 'private' ? 'blue' : 'green'}-800 rounded">
                                ${subnet.ip_type}
                            </span>
                        </div>
                        <div class="text-xs text-gray-600 mb-2">
                            Used: ${subnet.used_ips}/${subnet.total_ips}
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${subnet.utilization}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            Available: ${subnet.available_ips} (${subnet.utilization}%)
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading subnet overview:', error);
            }
        }

        // Utility functions
        function refreshData() {
            if (currentSection === 'dashboard') {
                loadDashboardData();
            } else if (currentSection === 'ip-management') {
                loadIPList(1);
            } else if (currentSection === 'subnet-management') {
                loadSubnetManagement();
            } else if (currentSection === 'vrf-monitoring') {
                loadVRFMonitoring();
            }
            showToast('Data refreshed successfully', 'success');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 translate-x-full`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }

        // Placeholder functions
        function openAssignIPModal() {
            showToast('Assign IP modal will be implemented', 'info');
        }

        function openBulkAssignModal() {
            showToast('Bulk assign modal will be implemented', 'info');
        }

        function clearFilters() {
            // Clear IP filters
            document.getElementById('ip-subnet-filter').value = '';
            document.getElementById('ip-status-filter').value = '';
            document.getElementById('ip-vrf-filter').value = '';
            
            // Clear CIDR filter
            document.getElementById('cidr-input').value = '';
            
            // Reload current section
            if (currentSection === 'ip-management') {
                loadIPList(1);
            } else if (currentSection === 'subnet-management') {
                loadSubnetManagement();
            }
            
            showToast('All filters cleared', 'success');
        }

        // VRF Monitoring functions
        async function loadVRFMonitoring() {
            try {
                const response = await fetch('/api/vrf-monitoring');
                const data = await response.json();
                
                document.getElementById('vrf-last-update').textContent = `Last updated: ${data.timestamp}`;
                
                const container = document.getElementById('vrf-grid');
                
                if (!data.vrf_data || data.vrf_data.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No VRF data available</div>';
                    return;
                }
                
                container.innerHTML = data.vrf_data.map(vrf => `
                    <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">${vrf.vrf_name}</h4>
                            <span class="text-sm px-3 py-1 bg-purple-100 text-purple-800 rounded-full">
                                ${vrf.utilization_percentage}% Used
                            </span>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Total IPs:</span>
                                    <span class="font-semibold ml-2">${vrf.total_ips.toLocaleString()}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Subnets:</span>
                                    <span class="font-semibold ml-2">${vrf.subnet_count}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Used:</span>
                                    <span class="font-semibold text-red-600 ml-2">${vrf.used_ips.toLocaleString()}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Available:</span>
                                    <span class="font-semibold text-green-600 ml-2">${vrf.available_ips.toLocaleString()}</span>
                                </div>
                            </div>
                            
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full" style="width: ${vrf.utilization_percentage}%"></div>
                            </div>
                            
                            <div class="text-xs text-gray-500">
                                <div class="flex justify-between">
                                    <span>Devices: ${vrf.device_count || 0}</span>
                                    <span>Last Update: ${vrf.last_update}</span>
                                </div>
                            </div>
                            
                            ${vrf.subnet_list && vrf.subnet_list.length > 0 ? `
                                <div class="pt-3 border-t border-gray-200">
                                    <div class="text-xs text-gray-500 mb-2">Subnets:</div>
                                    <div class="flex flex-wrap gap-1">
                                        ${vrf.subnet_list.map(subnet => `
                                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded cursor-pointer hover:bg-blue-200" 
                                                  onclick="openSubnetDetail('${subnet}')">${subnet}</span>
                                        `).join('')}
                                        ${vrf.has_more_subnets ? '<span class="text-xs text-gray-400">...</span>' : ''}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading VRF monitoring:', error);
                showToast('Failed to load VRF monitoring data', 'error');
            }
        }

        function refreshVRFData() {
            loadVRFMonitoring();
            showToast('VRF data refreshed', 'success');
        }

        // Subnet Detail Modal functions
        async function openSubnetDetail(subnet) {
            try {
                showToast('Loading subnet details...', 'info');
                
                const response = await fetch(`/api/subnet-detail/${encodeURIComponent(subnet)}`);
                const data = await response.json();
                
                if (data.error) {
                    showToast(`Error: ${data.error}`, 'error');
                    return;
                }
                
                currentSubnetData = data;
                
                // Update modal content
                document.getElementById('modal-subnet-title').textContent = `Subnet: ${data.subnet}`;
                document.getElementById('modal-subnet-info').textContent = 
                    `Network: ${data.network_address} - ${data.broadcast_address} (/${data.prefix_length})`;
                
                // Update summary cards
                document.getElementById('modal-total-ips').textContent = data.total_ips.toLocaleString();
                document.getElementById('modal-used-ips').textContent = data.used_ips.toLocaleString();
                document.getElementById('modal-available-ips').textContent = data.available_ips.toLocaleString();
                document.getElementById('modal-reserved-ips').textContent = data.reserved_ips.toLocaleString();
                document.getElementById('modal-utilization').textContent = `${data.utilization_percent}%`;
                
                // Update additional info
                document.getElementById('modal-network-info').textContent = `Mask: ${data.subnet_mask}`;
                document.getElementById('modal-used-percent').textContent = `${((data.used_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-available-percent').textContent = `${((data.available_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-reserved-percent').textContent = `${((data.reserved_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-utilization-bar').style.width = `${data.utilization_percent}%`;
                
                // Update VRF summary
                renderVRFSummary(data.vrf_summary);
                
                // Populate VRF filter dropdown
                populateVRFFilter(data.ip_list);
                
                // Render IP list
                renderModalIPList(data.ip_list);
                
                // Show modal
                document.getElementById('subnet-detail-modal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading subnet detail:', error);
                showToast('Failed to load subnet details', 'error');
            }
        }

        function closeSubnetModal() {
            document.getElementById('subnet-detail-modal').classList.add('hidden');
            currentSubnetData = null;
        }

        function renderVRFSummary(vrfSummary) {
            const container = document.getElementById('modal-vrf-summary');
            
            if (!vrfSummary || Object.keys(vrfSummary).length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500">No Service Domain allocation found</div>';
                return;
            }
            
            container.innerHTML = Object.entries(vrfSummary).map(([vrf, counts]) => `
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="text-sm text-purple-600 font-medium">${vrf}</div>
                    <div class="text-lg font-bold text-purple-900">${counts.used + counts.reserved} IPs</div>
                    <div class="text-xs text-purple-600">Used: ${counts.used}, Reserved: ${counts.reserved}</div>
                </div>
            `).join('');
        }

        function populateVRFFilter(ipList) {
            const vrfFilter = document.getElementById('modal-vrf-filter');
            const vrfs = [...new Set(ipList.map(ip => ip.vrf_vpn).filter(vrf => vrf))];
            
            vrfFilter.innerHTML = '<option value="">All VRFs</option>' + 
                vrfs.map(vrf => `<option value="${vrf}">${vrf}</option>`).join('');
        }

        function renderModalIPList(ipList) {
            const tbody = document.getElementById('modal-ip-list');
            
            if (!ipList || ipList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No IP addresses found</td></tr>';
                return;
            }
            
            tbody.innerHTML = ipList.map(ip => {
                // Parse additional info from description
                let interfaceInfo = '';
                let deviceInfo = ip.device_name || ip.hostname || '';
                let vendorInfo = '';
                
                if (ip.description) {
                    // Extract interface info
                    if (ip.description.includes('Interface:')) {
                        const interfaceMatch = ip.description.match(/Interface:\s*([^|]+)/);
                        if (interfaceMatch) {
                            interfaceInfo = interfaceMatch[1].trim();
                        }
                    }
                    
                    // Extract vendor info
                    if (ip.description.includes('Vendor:')) {
                        const vendorMatch = ip.description.match(/Vendor:\s*([^|]+)/);
                        if (vendorMatch) {
                            vendorInfo = vendorMatch[1].trim();
                        }
                    }
                }
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="font-mono text-sm font-medium text-gray-900">${ip.ip_address}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${ip.status === 'used' ? 'bg-red-100 text-red-800' : 
                                  ip.status === 'available' ? 'bg-green-100 text-green-800' : 
                                  'bg-yellow-100 text-yellow-800'}">
                                ${ip.status}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 max-w-xs" title="${deviceInfo}">
                            <div class="truncate">${deviceInfo || '-'}</div>
                            ${vendorInfo ? `<div class="text-xs text-gray-500">${vendorInfo}</div>` : ''}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 max-w-xs" title="${ip.description || '-'}">
                            <div class="truncate">${ip.description || '-'}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-purple-600">${ip.vrf_vpn || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${deviceInfo || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${interfaceInfo || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function filterModalIPs() {
            if (!currentSubnetData) return;
            
            const statusFilter = document.getElementById('modal-ip-filter').value;
            const vrfFilter = document.getElementById('modal-vrf-filter').value;
            
            let filteredIPs = currentSubnetData.ip_list;
            
            if (statusFilter) {
                filteredIPs = filteredIPs.filter(ip => ip.status === statusFilter);
            }
            
            if (vrfFilter) {
                filteredIPs = filteredIPs.filter(ip => ip.vrf_vpn === vrfFilter);
            }
            
            renderModalIPList(filteredIPs);
        }

        // Add Subnet Modal Functions
        function openAddSubnetModal() {
            document.getElementById('add-subnet-modal').classList.remove('hidden');
        }

        function closeAddSubnetModal() {
            document.getElementById('add-subnet-modal').classList.add('hidden');
            document.getElementById('add-subnet-form').reset();
        }

        function submitSubnetForm() {
            const form = document.getElementById('add-subnet-form');
            const formData = new FormData(form);
            
            const subnetData = {
                subnet: formData.get('subnet'),
                description: formData.get('description'),
                section: formData.get('section'),
                vlan: formData.get('vlan'),
                device: formData.get('device'),
                nameservers: formData.get('nameservers'),
                master_subnet: formData.get('master_subnet'),
                vrf: formData.get('vrf'),
                customer: formData.get('customer'),
                location: formData.get('location'),
                mark_as_pool: formData.get('mark_as_pool') === 'on',
                mark_as_full: formData.get('mark_as_full') === 'on',
                threshold_percentage: parseInt(formData.get('threshold_percentage')) || 80,
                check_hosts_status: formData.get('check_hosts_status') === 'on',
                discover_new_hosts: formData.get('discover_new_hosts') === 'on',
                resolve_dns_names: formData.get('resolve_dns_names') === 'on',
                show_as_name: formData.get('show_as_name') === 'on',
                irr: formData.get('irr')
            };

            fetch('/api/subnets', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(subnetData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('Subnet added successfully!');
                    closeAddSubnetModal();
                    // Refresh the subnet data
                    if (currentSection === 'subnet-management') {
                        applyCIDRFilter();
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding subnet');
            });
        }

        // Load subnet list
        function loadSubnetList() {
            fetch('/api/subnets')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error loading subnets:', data.error);
                        document.getElementById('subnet-list-body').innerHTML = 
                            '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error loading subnet list</td></tr>';
                        return;
                    }
                    
                    renderSubnetList(data.subnets);
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('subnet-list-body').innerHTML = 
                        '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error loading subnet list</td></tr>';
                });
        }

        function renderSubnetList(subnets) {
            const tbody = document.getElementById('subnet-list-body');
            
            if (!subnets || subnets.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No subnets configured</td></tr>';
                return;
            }
            
            tbody.innerHTML = subnets.map(subnet => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900">${subnet.subnet}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${subnet.description || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.section || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.vlan || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.vrf || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editSubnet(${subnet.id})" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button onclick="deleteSubnet(${subnet.id}, '${subnet.subnet}')" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function editSubnet(subnetId) {
            alert('Edit subnet functionality will be implemented soon');
        }

        function deleteSubnet(subnetId, subnetName) {
            if (!confirm(`Are you sure you want to delete subnet ${subnetName}?`)) {
                return;
            }
            
            fetch(`/api/subnets/${subnetId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('Subnet deleted successfully!');
                    loadSubnetList();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting subnet');
            });
        }

        function toggleSubnetDetails() {
            showToast('Subnet details toggle will be implemented', 'info');
        }
    </script>

    <!-- Add Subnet Modal -->
    <div id="add-subnet-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Subnet</h3>
                    <button onclick="closeAddSubnetModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="add-subnet-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div class="space-y-4">
                            <!-- Subnet -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Subnet *</label>
                                <input type="text" name="subnet" placeholder="Enter subnet in CIDR format (e.g., 192.168.1.0/24)" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <p class="text-xs text-gray-500 mt-1">Required field</p>
                            </div>
                            
                            <!-- Description -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <input type="text" name="description" placeholder="Enter subnet description" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Section -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Section</label>
                                <select name="section" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select section</option>
                                    <option value="Public - IPv4">Public - IPv4</option>
                                    <option value="Private - IPv4">Private - IPv4</option>
                                    <option value="Management">Management</option>
                                    <option value="DMZ">DMZ</option>
                                </select>
                            </div>
                            
                            <!-- VLAN -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">VLAN</label>
                                <input type="text" name="vlan" placeholder="Enter VLAN ID" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Device -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Device</label>
                                <input type="text" name="device" placeholder="Enter device name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Nameservers -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nameservers</label>
                                <input type="text" name="nameservers" placeholder="Enter nameservers (comma separated)" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div class="space-y-4">
                            <!-- Master Subnet -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Master Subnet</label>
                                <input type="text" name="master_subnet" placeholder="Enter master subnet if nested" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- VRF -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">VRF</label>
                                <input type="text" name="vrf" placeholder="Enter VRF name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Customer -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                                <input type="text" name="customer" placeholder="Enter customer name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Location -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input type="text" name="location" placeholder="Enter location" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Threshold Percentage -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Threshold Percentage</label>
                                <input type="number" name="threshold_percentage" value="80" min="0" max="100" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- IRR -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">IRR</label>
                                <select name="irr" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">No</option>
                                    <option value="Yes">Yes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkboxes Section -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">Configuration Options</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" name="mark_as_pool" class="mr-2">
                                <span class="text-sm text-gray-700">Mark as Pool</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="mark_as_full" class="mr-2">
                                <span class="text-sm text-gray-700">Mark as Full</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="check_hosts_status" class="mr-2">
                                <span class="text-sm text-gray-700">Check Hosts Status</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="discover_new_hosts" class="mr-2">
                                <span class="text-sm text-gray-700">Discover New Hosts</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="resolve_dns_names" class="mr-2">
                                <span class="text-sm text-gray-700">Resolve DNS Names</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="show_as_name" class="mr-2">
                                <span class="text-sm text-gray-700">Show as Name</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeAddSubnetModal()" 
                                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="button" onclick="submitSubnetForm()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Add Subnet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ================== IP AUTO ALLOCATION FUNCTIONS ==================
        let suggestedIPs = [];
        
        // Load data when IP Auto Allocation section is shown
        function loadAutoAllocationData() {
            loadAvailableSubnets();
            loadVRFList();
        }
        
        // Load available subnets
        async function loadAvailableSubnets() {
            try {
                const response = await fetch('/api/available-subnets');
                const data = await response.json();
                
                const subnetSelect = document.getElementById('allocation-subnet');
                subnetSelect.innerHTML = '<option value="">Choose a subnet...</option>';
                
                data.subnets.forEach(subnet => {
                    const option = document.createElement('option');
                    option.value = subnet.subnet;
                    option.textContent = `${subnet.subnet} (${subnet.available_count} available, ${subnet.utilization_percent}% used)`;
                    option.dataset.available = subnet.available_count;
                    option.dataset.utilization = subnet.utilization_percent;
                    subnetSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading subnets:', error);
                showNotification('Error loading subnets', 'error');
            }
        }
        
        // Load VRF list
        async function loadVRFList() {
            try {
                const response = await fetch('/api/vrf-list');
                const data = await response.json();
                
                const vrfSelect = document.getElementById('allocation-vrf');
                vrfSelect.innerHTML = '<option value="">Select VRF...</option>';
                
                data.vrfs.forEach(vrf => {
                    const option = document.createElement('option');
                    option.value = vrf.vrf_name;
                    option.textContent = `${vrf.vrf_name} (${vrf.ip_count} IPs)`;
                    vrfSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading VRFs:', error);
                showNotification('Error loading VRFs', 'error');
            }
        }
        
        // Update subnet info when subnet is selected
        function updateSubnetInfo() {
            const subnetSelect = document.getElementById('allocation-subnet');
            const selectedOption = subnetSelect.options[subnetSelect.selectedIndex];
            const subnetInfo = document.getElementById('subnet-info');
            
            if (selectedOption.value) {
                const available = selectedOption.dataset.available;
                const utilization = selectedOption.dataset.utilization;
                subnetInfo.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <span class="text-green-600">📊 ${available} IPs available</span>
                        <span class="text-blue-600">📈 ${utilization}% utilized</span>
                    </div>
                `;
            } else {
                subnetInfo.innerHTML = '';
            }
        }
        
        // Get suggested IPs
        async function getSuggestedIPs() {
            const subnet = document.getElementById('allocation-subnet').value;
            const count = parseInt(document.getElementById('allocation-count').value);
            
            if (!subnet) {
                showNotification('Please select a subnet', 'error');
                return;
            }
            
            if (!count || count < 1 || count > 50) {
                showNotification('Please enter a valid number of IPs (1-50)', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/suggest-ips', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subnet, count })
                });
                
                const data = await response.json();
                
                if (data.success || data.warning) {
                    suggestedIPs = data.suggested_ips;
                    displaySuggestedIPs(data);
                    document.getElementById('reserve-section').classList.remove('hidden');
                } else {
                    showNotification(data.error || 'Error getting IP suggestions', 'error');
                }
                
            } catch (error) {
                console.error('Error getting IP suggestions:', error);
                showNotification('Error getting IP suggestions', 'error');
            }
        }
        
        // Display suggested IPs
        function displaySuggestedIPs(data) {
            const container = document.getElementById('suggestions-container');
            
            let html = '';
            
            if (data.warning) {
                html += `<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                        <span class="text-yellow-800">${data.warning}</span>
                    </div>
                </div>`;
            }
            
            if (data.suggested_ips.length > 0) {
                html += `<div class="text-left">
                    <h4 class="font-semibold text-gray-900 mb-3">Suggested IP Addresses:</h4>
                    <div class="grid grid-cols-2 gap-2">`;
                
                data.suggested_ips.forEach(ip => {
                    html += `<div class="bg-green-50 border border-green-200 rounded px-3 py-2 text-center">
                        <span class="font-mono text-green-800">${ip}</span>
                    </div>`;
                });
                
                html += `</div>
                    <div class="mt-4 text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-2"></i>
                        ${data.suggested_ips.length} IP(s) suggested from ${data.available_count} available
                    </div>
                </div>`;
            } else {
                html = `<div class="text-center">
                    <i class="fas fa-times-circle text-4xl text-red-400 mb-4"></i>
                    <p class="text-red-600">No available IPs found in selected subnet</p>
                </div>`;
            }
            
            container.innerHTML = html;
        }
        
        // Reserve all suggested IPs
        async function reserveAllIPs() {
            const subnet = document.getElementById('allocation-subnet').value;
            const vrf_vpn = document.getElementById('allocation-vrf').value;
            const service = document.getElementById('allocation-service').value;
            const description = document.getElementById('allocation-description').value;
            
            if (suggestedIPs.length === 0) {
                showNotification('No IPs to reserve', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/bulk-reserve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ip_list: suggestedIPs,
                        subnet,
                        vrf_vpn,
                        service,
                        description
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let message = `Successfully reserved ${data.total_reserved} IP(s)`;
                    if (data.total_failed > 0) {
                        message += `, ${data.total_failed} failed`;
                    }
                    
                    showNotification(message, 'success');
                    clearForm();
                    
                    // Refresh data
                    refreshData();
                    loadAvailableSubnets();
                    
                } else {
                    showNotification(data.error || 'Error reserving IPs', 'error');
                }
                
            } catch (error) {
                console.error('Error reserving IPs:', error);
                showNotification('Error reserving IPs', 'error');
            }
        }
        
        // Clear allocation form
        function clearForm() {
            document.getElementById('allocation-subnet').value = '';
            document.getElementById('allocation-count').value = '1';
            document.getElementById('allocation-vrf').value = '';
            document.getElementById('allocation-service').value = '';
            document.getElementById('allocation-description').value = '';
            document.getElementById('subnet-info').innerHTML = '';
            
            const container = document.getElementById('suggestions-container');
            container.innerHTML = `
                <i class="fas fa-lightbulb text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500">Click "Get IP Suggestions" to see available IPs</p>
            `;
            
            document.getElementById('reserve-section').classList.add('hidden');
            suggestedIPs = [];
        }
        
        // Refresh subnet list
        function refreshSubnetList() {
            loadAvailableSubnets();
            showNotification('Subnet list refreshed', 'info');
        }
    </script>

    <!-- IP Details Modal -->
    <div id="ipDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900" id="ipModalTitle">IP Details</h2>
                    <button onclick="closeIPDetailsModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="ipModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Subnet Details Modal -->
    <div id="subnetDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-network-wired mr-3 text-purple-600"></i>
                        Subnet Management Overview
                    </h2>
                    <button onclick="closeSubnetDetailsModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="subnetModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- VRF Details Modal -->
    <div id="vrfDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-sitemap mr-3 text-green-600"></i>
                        Service Domains (VRF) Overview
                    </h2>
                    <button onclick="closeVRFDetailsModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="vrfModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

</body>
</html>
